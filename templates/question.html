<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{ question["question"] }}</title>
        <link href='https://fonts.googleapis.com/css?family=Karla' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="{{ static_url("css/reset.css") }}">
        <link rel="stylesheet" href="{{ static_url("css/question.css") }}">
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>
        <header role="banner">
            <h1><a href="/">Hive</a></h1>
        </header>
        <section>
             <article>
                <div class="asker-info">
                    <a href="/users/{{ str(asker["_id"]) }}">
                        <img src="{{ asker["profile_pic_link"] }}">
                    </a>
                    <table>
                        <tr>
                            <td>
                                <h2>
                                    <a href="/users/{{ str(asker["_id"]) }}">{{ asker["username"] }}</a>
                                </h2>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <h3>
                                    {% set total_seconds = (datetime.utcnow() - question["date"]).total_seconds() %}
                                    {% if total_seconds < 30 %}
                                        Just now
                                    {% elif total_seconds < 60 %}
                                        {{ int(total_seconds) }}s ago
                                    {% elif total_seconds < 3600 %}
                                        {{ int(total_seconds * 0.0166667) }}m ago
                                    {% elif total_seconds < 86400 %}
                                        {{ int(total_seconds * 0.000277778) }}h
                                    {% elif total_seconds < 172800 %}
                                        Yesterday
                                    {% elif total_seconds < 15770000 %}
                                        {{ question["date"].strftime("%B %d") }}
                                    {% else %}
                                        {{ question["date"].strftime("%B %d, %Y") }}
                                    {% end %}
                                </h3>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="question-image" style="background-image: url({{ question["image_link"] }})"></div>
                <div class="chart">
                    <h1 class="question">{{ question["question"] }}</h1>
                    <canvas>
                        <div class="chart-labels">{{ question["labels"] }}</div>
                        <div class="chart-data">{{ question["data"] }}</div>
                    </canvas>
                    <div class="chart-footer">
                        <h4 class="favorite-count">
                            {% set favorites = question["favorites"] %}
                            {% if favorites <= 1000 %}
                                {{ favorites }}
                            {% elif favorites <= 999999 %}
                                {{ round(favorites/1000, 1) }}K
                            {% else %}
                                {{ round(favorites/1000000, 1) }}M
                            {% end %}
                            {% if favorited %}
                                <img class="active" src="{{ static_url("images/heart.svg") }}">
                                <img src="{{ static_url("images/heart-outlined.svg") }}">
                            {% else %}
                                <img src="{{ static_url("images/heart.svg") }}">
                                <img class="active" src="{{ static_url("images/heart-outlined.svg") }}">  
                            {% end %}
                        </h4>
                        <h4 class="share-count">
                            {% set shares = question["shares"] %}
                            {% if shares <= 1000 %}
                                {{ shares }}
                            {% elif shares <= 999999 %}
                                {{ round(shares/1000, 1) }}K
                            {% else %}
                                {{ round(shares/1000000, 1) }}M
                            {% end %}
                            {% if shared %}
                                <img class="active" src="{{ static_url("images/forward-purple.svg") }}">
                                <img src="{{ static_url("images/forward.svg") }}">
                            {% else %}
                                <img src="{{ static_url("images/forward-purple.svg") }}">
                                <img class="active" src="{{ static_url("images/forward.svg") }}">  
                            {% end %}
                        </h4>
                        <h4 class="poll-count">
                            {% set votes = sum(question["data"]) %}
                            {% if votes <= 1000 %}
                                {{ votes }}
                            {% elif votes <= 999999 %}
                                {{ round(votes/1000, 1) }}K
                            {% else %}
                                {{ round(votes/1000000, 1) }}M
                            {% end %}
                            <img class="active" src="{{ static_url("images/download.svg") }}">
                        </h4>
                    </div>
                    <div class="comment-section">
                        {% if len(question["comments"]) != 0 %}
                            {% set idx = 0 %}
                            {% for comment in question["comments"] %}
                                {% while users[idx]["email"] != comment[0] %}
                                    {% set idx = (idx + 1) % len(users) %}
                                {% end %}
                                <div class="comment">
                                    <a href="/users/{{ str(users[idx]["_id"]) }}">
                                        <img class="profile-pic" src="{{ users[idx]["profile_pic_link"] }}">
                                    </a>
                                    <div class="comment-text">
                                        <a href="/users/{{ str(users[idx]["_id"]) }}">
                                            <h3>{{ users[idx]["username"] }}</h3>
                                        </a>
                                        <h5>
                                            {% set total_seconds = (datetime.utcnow() - comment[1]).total_seconds() %}
                                            {% if total_seconds < 30 %}
                                                Just now
                                            {% elif total_seconds < 60 %}
                                                {{ int(total_seconds) }}s ago
                                            {% elif total_seconds < 3600 %}
                                                {{ int(total_seconds * 0.0166667) }}m ago
                                            {% elif total_seconds < 86400 %}
                                                {{ int(total_seconds * 0.000277778) }}h
                                            {% elif total_seconds < 172800 %}
                                                Yesterday
                                            {% elif total_seconds < 15770000 %}
                                                {{ comment[1].strftime("%B %d") }}
                                            {% else %}
                                                {{ comment[1].strftime("%B %d, %Y") }}
                                            {% end %}
                                        </h5>
                                        <h4>{{ comment[2] }}</h4>
                                    </div>
                                </div>
                            {% end %}
                        {% end %}
                        <form method="post" action={{ "/comments/" + str(question["_id"]) }}>
                            {% raw xsrf_form_html() %}
                            <input type="text" name="comment" autocomplete="off" required="required" placeholder="Share your thoughts...">
                        </form>
                    </div>
                </div>
            </article>
        </section>
        <footer role="contentinfo">
            <ul>
                <li><a class="footer-links" href="">Blog</a></li>
                <li><a class="footer-links" href="">Email Us</a></li>
                <li><a class="footer-links" href="">Jobs</a></li>
                <li><a class="footer-links" href="">Terms</a></li>
                <li><a class="footer-links" href="">Privacy</a></li>
                <li><a class="footer-links" href="">Cookie</a></li>
                <li><a class="footer-links" href="">Copyright</a></li>
                <li>&copy; 2016<br>Hive, Inc.</li>
            </ul>
        </footer>
        <script src="{{ static_url("js/jquery.min.js") }}"></script>
        <script src="{{ static_url("js/Chart.js") }}"></script>
        <script src="{{ static_url("js/chartmaker.js") }}"></script>
        <script src="{{ static_url("js/question.js") }}"></script>
    </body>
</html>